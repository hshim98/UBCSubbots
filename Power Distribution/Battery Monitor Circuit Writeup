Battery Monitor Writeup

Purpose: 
LiPo batteries need to be handled with extreme caution, and keeping track of the cell voltage is one of the tasks to protect the battery. LiPo batteries are usually advised to be maintained higher than 3.6V per cell. In order to do this wihout manually checking the cell voltage, we need a battery monitoring circuit to cut off all connections once the cell voltage reaches that level. 

Components & Functionalities of each part of the circuit:
1. Connector & display: This part is not built in but it is extremely important. When connecting the battery, it is crucial to make connections using proper connectors and not just through wires. This will ensure that nothing is shorted. The muted beeper is only used to display the cell voltages. Do not use the output of the beeper for logic operations. 
2. Rail to rail op-amps as difference op-amps: The pins that come with the LiPo battery outputs the following-> (GND, 1st cell, 1st+2nd cell, 1st+2nd+3rd cell). Since we need to monitor if a single cell goes below the threshold, we need to subtract the cell voltages to isolate for the individual cells with the difference op-amps.
3. Comparators: Now we compare the extracted individual cell voltages to the threshold voltage. If the cell voltage is above the threshold, the comparator output is pulled up to 5V(logic high for the AND gate). If the cell voltage goes below the threshold, the comparator output is grounded (logic LOW for the AND gate).
4. AND gate: If any one of the cell voltages go below the threshold, meaning the comparator output for that cell is GND, then one of the inputs to the AND gate is LOW, therefore the output of the gate is also LOW. This should notify us to shut down the system to stop draining the battery cell. The output is pulled down to GND with a resistor to ensure that the output will always be low even if nothing is plugged in (safety reasons).
5. Relay: The relay is a electromechanical switch to shut off the system when the output of the AND gate is LOW. 
6. Voltage regulators & dividers: Voltage rails of 5V and 3.6V are required for these logic operations and powering some of the components. Since our battery total voltage is ~12V, we use a voltage regulator for the 5V, and a voltage dividing circuit for the 3.6V from the created 5V rail. (It is important to make the voltage divide from the 5V and not the ~12V since only the 5V rail is steady)

How to make them:
1. Connector & display: Crimp connectors are probably the best option as one end is already fitted with that connector type. For prototyping, You can use the male header pins to make connections on the breadboard. Using a connector will allow to easily split up the voltage to go to the logic portion and to the display. Since the display is drawing power from the battery to turn on, if it is not turning on it is probably because the logic portion is drawing too much power. Try to increase impedence into the logic portion by using a buffer directly before the difference opamps.
2. OpAmp: Prototyped. The opamp is set up in a difference opamp configuration. All resistor values should be equal. Due to manufacturer defficiencies, none of them will be equal (bummer) and the closer you get them to be equal, the more precise the output will be. This uncertainty needs to be taken into account when you read the output (the difference in the cell voltages). Ex) if 1st cell is 3.9V and 1st+2nd cell is 7.65V, then you know that 2nd cell is at 3.75V. But if your difference op-amp gives you 3.7V that is ok. If the op-amp gives you 3.8V, this is not good since it is OVER the true cell voltage. 
3. Comparators: Prototyped. Comparators are hooked up with the 3.6V threshold that is created by the voltage divider. Ensure when you are building the circuit that + input is connected to the voltage differences and - input is connected to the voltage threshold (verify with the prototype). Although this is untested, we think there might be some problems with bounciness when the inputs to the comparator get very close to each other. To get rid of this, we think a smoothing RC circuit at the output of each comparator might solve that problem. That is, connect a capacitor between the output and ground, and a resistor between output and ground (R and C parallel to each other). Choose the value of R*C (i.e. time constant of the RC circuit) to be greater than the fluctuation period. Try to make this RC value as small as possible while still functional though. The larger the value the slower the response of the circuit and the more expensive the components get.
4. AND gate: prototyped. Just make sure when you're building that all inputs are actually of the same AND gate (there are 3 in one chip). Don't forget to pull the output down via a large resistor (~47kOhm is usually a safe bet).
5. Relay: When building, just make sure the relay you select is conducting when the input is HIGH and non-conducting when the input is LOW (HIGH means circuit should work, LOW means it should not). Also be sure to check the data sheet of whatever relay you select to see if any voltage supressing devices are needed (resistor, diode, etc.). There will usually be an example circuit on the datasheet.
6. Voltage regulators and dividers: Prototyped. Just look at the prototype circuit and datasheet to see how to hook up the voltage regulator. Since it is a fixed regulator it is pretty simple. Make sure the ones you grab are the fixed regulators and not the adjustable ones, we have both. For the voltage divider, try to have resistors in the kOhm range for low power dissipation. Use precision resistors (measure resistor values carefully to account for manufacturer errors) to try and get as close as possible to 3.6V. Connect from the steady 5V rail created by the regulator.

***NOTE: Make sure all components are powered from the regular +/- power of the battery to ensure shut down in the case where the monitor is not plugged in. Use the cell voltage levels only as inputs to the circuit and not as power.
